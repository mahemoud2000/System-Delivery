<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Realtime Database Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getDatabase, ref, onValue, remove, update } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBon5IxjZIlqe3P44MTKXu6xTqX5kdKnCA",
            authDomain: "add-owner.firebaseapp.com",
            projectId: "add-owner",
            storageBucket: "add-owner.appspot.com",
            messagingSenderId: "367416374034",
            appId: "1:367416374034:web:e5b5cd9b190083c2adb9cb",
            databaseURL: "https://add-owner-default-rtdb.firebaseio.com/"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.fetchData = function(listName, outputId, buttonId) {
            const dbRef = ref(db, listName);
            onValue(dbRef, (snapshot) => {
                const data = snapshot.val();
                let output = document.getElementById(outputId);
                output.innerHTML = '';

                if (data) {
                    let index = 1;
                    for (let key in data) {
                        const item = data[key];
                        const date = new Date(item.createdAt).toLocaleString();
                        output.innerHTML += `
                            <tr>
                                <th scope="row">${index++}</th>
                                <td>${item.name || 'N/A'}</td>
                                <td>${item.email || 'N/A'}</td>
                                <td>${item.phone || 'N/A'}</td>
                                <td>${item.password || 'N/A'}</td>
                                <td>${date}</td>
                                <td>
                                    <button class="btn btn-warning btn-sm" onclick="editItem('${listName}', '${key}')">Edit</button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteItem('${listName}', '${key}')">Delete</button>
                                </td>
                            </tr>
                        `;
                    }
                } else {
                    output.innerHTML = `<tr><td colspan="7">No data available</td></tr>`;
                }
            });
        };

        window.deleteItem = function(listName, itemId) {
            const itemRef = ref(db, `${listName}/${itemId}`);
            const deletedItemRef = ref(db, `removed_${listName}/${itemId}`);

            onValue(itemRef, (snapshot) => {
                const itemData = snapshot.val();
                update(deletedItemRef, itemData).then(() => {
                    return remove(itemRef);
                }).then(() => {
                    alert('Item deleted and moved to removed list');
                }).catch((error) => {
                    console.error('Error deleting item:', error);
                });
            });
        };

        window.editItem = function(listName, itemId) {
            const itemRef = ref(db, `${listName}/${itemId}`);
            onValue(itemRef, (snapshot) => {
                const item = snapshot.val();
                const newData = prompt("Edit data in JSON format (name, email, phone, password):", JSON.stringify(item));
                if (newData) {
                    try {
                        const parsedData = JSON.parse(newData);
                        update(itemRef, parsedData).then(() => {
                            alert('Item updated');
                        }).catch((error) => {
                            console.error('Error updating item:', error);
                        });
                    } catch (e) {
                        alert("Invalid JSON format");
                        console.error("JSON Parse Error:", e);
                    }
                }
            });
        };
    </script>

    <style>
        body {
            padding: 20px;
        }
        .table th, .table td {
            vertical-align: middle;
        }
        h2 {
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center">Firebase Realtime Database Dashboard</h1>

        <h2>
            Owner
            <button class="btn btn-primary" onclick="fetchData('owner', 'output-owner', 'btn-owner')">Load Data</button>
        </h2>
        <table class="table table-striped table-bordered">
            <thead class="table-dark">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Name</th>
                    <th scope="col">Email</th>
                    <th scope="col">Phone</th>
                    <th scope="col">Password</th>
                    <th scope="col">Date</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody id="output-owner"></tbody>
        </table>

        <h2>
            Admins
            <button class="btn btn-primary" onclick="fetchData('admins', 'output-admins', 'btn-admins')">Load Data</button>
        </h2>
        <table class="table table-striped table-bordered">
            <thead class="table-dark">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Name</th>
                    <th scope="col">Email</th>
                    <th scope="col">Phone</th>
                    <th scope="col">Password</th>
                    <th scope="col">Date</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody id="output-admins"></tbody>
        </table>

        <h2>
            Restaurant Accounts
            <button class="btn btn-primary" onclick="fetchData('restaurant accounts', 'output-restaurant-accounts', 'btn-restaurant-accounts')">Load Data</button>
        </h2>
        <table class="table table-striped table-bordered">
            <thead class="table-dark">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Name</th>
                    <th scope="col">Email</th>
                    <th scope="col">Phone</th>
                    <th scope="col">Password</th>
                    <th scope="col">Date</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody id="output-restaurant-accounts"></tbody>
        </table>

        <h2>
            Delivery Person
            <button class="btn btn-primary" onclick="fetchData('Delivery Person', 'output-delivery-person', 'btn-delivery-person')">Load Data</button>
        </h2>
        <table class="table table-striped table-bordered">
            <thead class="table-dark">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Name</th>
                    <th scope="col">Email</th>
                    <th scope="col">Phone</th>
                    <th scope="col">Password</th>
                    <th scope="col">Date</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody id="output-delivery-person"></tbody>
        </table>
    </div>
</body>
</html>
