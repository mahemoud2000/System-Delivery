<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Dashboard with Trash</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        button {
            padding: 5px 10px;
            margin: 0 5px;
            cursor: pointer;
        }
        #trashTable {
            display: none; /* إخفاء جدول المهملات في البداية */
        }
    </style>
</head>
<body>

    <h1>Dashboard</h1>
    <a href="add-users.html" target="_blank">Add Users</a>
    <h2>Active Users</h2>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Phone</th>
                <th>Email</th>
                <th>Last Updated</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="dataTable">
            <!-- Data will be populated here -->
        </tbody>
    </table>

    <button onclick="toggleTrash()">Toggle Trash</button> <!-- زرار عرض المهملات -->

    <h2>Trash</h2>
    <table id="trashTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Phone</th>
                <th>Email</th>
                <th>Deleted At</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="trashTableBody">
            <!-- Trash data will be populated here -->
        </tbody>
    </table>

    <!-- Load Firebase SDK v8 from CDN -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBzWStPRbvQ4f6Wp13iCw70N60IfZIBcGw",
            authDomain: "web-cv-pro.firebaseapp.com",
            projectId: "web-cv-pro",
            storageBucket: "web-cv-pro.appspot.com",
            messagingSenderId: "282734467735",
            appId: "1:282734467735:web:ad0f4f4c160999198327d2"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const usersRef = database.ref('users');
        const trashRef = database.ref('trash');

        // Get the table body elements
        const dataTable = document.getElementById('dataTable');
        const trashTableBody = document.getElementById('trashTableBody');

        // Retrieve data from Firebase Realtime Database
        usersRef.on('value', (snapshot) => {
            dataTable.innerHTML = '';
            const users = snapshot.val();

            for (let id in users) {
                const user = users[id];
                const row = `<tr id="${id}">
                                <td><input type="text" value="${user.name}" id="name-${id}" /></td>
                                <td><input type="number" value="${user.phone}" id="phone-${id}" /></td>
                                <td><input type="email" value="${user.email}" id="email-${id}" /></td>
                                <td>${user.updatedAt ? user.updatedAt : 'N/A'}</td>
                                <td>
                                    <button onclick="updateUser('${id}')">Update</button>
                                    <button onclick="deleteUser('${id}')">Delete</button>
                                </td>
                             </tr>`;
                dataTable.innerHTML += row;
            }
        });

        // Retrieve data from Trash
        trashRef.on('value', (snapshot) => {
            trashTableBody.innerHTML = '';
            const trashItems = snapshot.val();

            for (let id in trashItems) {
                const item = trashItems[id];
                const row = `<tr id="${id}">
                                <td>${item.name}</td>
                                <td>${item.phone}</td>
                                <td>${item.email}</td>
                                <td>${item.deletedAt ? item.deletedAt : 'N/A'}</td>
                                <td>
                                    <button onclick="restoreUser('${id}')">Restore</button>
                                    <button onclick="permanentlyDeleteUser('${id}')">Delete Permanently</button>
                                </td>
                             </tr>`;
                trashTableBody.innerHTML += row;
            }
        });

        // Function to toggle the visibility of the trash table
        function toggleTrash() {
            const trashTable = document.getElementById('trashTable');
            if (trashTable.style.display === 'none') {
                trashTable.style.display = 'table'; // إظهار الجدول
            } else {
                trashTable.style.display = 'none'; // إخفاء الجدول
            }
        }

        // Function to update user data
        function updateUser(id) {
            const name = document.getElementById(`name-${id}`).value;
            const email = document.getElementById(`email-${id}`).value;
            const phone = document.getElementById(`phone-${id}`).value;
            const updatedAt = new Date().toLocaleString();

            usersRef.child(id).update({
                name: name,
                email: email,
                phone: phone,
                updatedAt: updatedAt
            }).then(() => {
                alert('Data updated successfully!');
            }).catch((error) => {
                console.error('Error updating data:', error);
                alert('Error updating data: ' + error.message);
            });
        }

        // Function to delete user data (move to trash)
        function deleteUser(id) {
            if (confirm('Are you sure you want to delete this user?')) {
                usersRef.child(id).once('value').then(snapshot => {
                    const userData = snapshot.val();
                    if (userData) {
                        userData.deletedAt = new Date().toLocaleString(); // Add deletedAt field
                        trashRef.child(id).set(userData).then(() => {
                            usersRef.child(id).remove().then(() => {
                                alert('Data moved to trash successfully!');
                            });
                        });
                    }
                });
            }
        }

        // Function to restore user data from trash
        function restoreUser(id) {
            trashRef.child(id).once('value').then(snapshot => {
                const userData = snapshot.val();
                if (userData) {
                    const usersRef = database.ref('users');
                    usersRef.child(id).set(userData).then(() => {
                        alert('Data restored successfully!');
                        trashRef.child(id).remove(); // Remove from trash
                    });
                }
            });
        }

        // Function to permanently delete user data from trash
        function permanentlyDeleteUser(id) {
            if (confirm('Are you sure you want to permanently delete this user?')) {
                trashRef.child(id).remove().then(() => {
                    alert('Data deleted permanently!');
                });
            }
        }
    </script>
</body>
</html>
